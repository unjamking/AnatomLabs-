// Prisma schema for Human Performance Science Platform

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ========== USER MANAGEMENT ==========

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  
  // Physical attributes for calculations
  age       Int
  gender    String   // "male" or "female"
  weight    Float    // kg
  height    Float    // cm
  
  // Fitness profile
  activityLevel     String   // "sedentary", "light", "moderate", "active", "very_active"
  fitnessGoal       String   // "muscle_gain", "fat_loss", "endurance", "general_fitness", "sport_specific"
  experienceLevel   String   // "beginner", "intermediate", "advanced"
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  workoutPlans    WorkoutPlan[]
  nutritionLogs   NutritionLog[]
  activityLogs    ActivityLog[]
  reports         Report[]
  muscleUsageLogs MuscleUsageLog[]
  
  @@map("users")
}

// ========== ANATOMY & BODY PARTS ==========

model BodyPart {
  id          String   @id @default(uuid())
  name        String   @unique
  type        String   // "muscle", "organ", "bone"
  category    String   // "upper_body", "lower_body", "core", "cardiovascular", "skeletal"
  
  // Educational content
  description String   @db.Text
  function    String   @db.Text
  importance  String   @db.Text
  movement    String?  @db.Text  // How it works during movement (for muscles)
  
  // 3D model data
  modelLayer  String   // "full_body", "muscles_bones", "skeleton_organs"
  position3D  Json     // {x, y, z} coordinates for highlighting
  
  // Recovery time (for muscles only, in hours)
  recoveryTime Int?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  exercises       ExerciseBodyPart[]
  muscleUsageLogs MuscleUsageLog[]
  
  @@map("body_parts")
}

// ========== EXERCISES ==========

model Exercise {
  id          String   @id @default(uuid())
  name        String   @unique
  category    String   // "strength", "cardio", "flexibility", "sport_specific"
  difficulty  String   // "beginner", "intermediate", "advanced"
  equipment   String   // "none", "dumbbells", "barbell", "machine", "resistance_band", etc.
  
  // Exercise details
  description String   @db.Text
  instructions String  @db.Text
  
  // Sport-specific tags
  sportTags   String[] // ["football", "basketball", "general", etc.]
  
  // Biomechanics explanation
  mechanicalLoad  String   @db.Text  // Explanation of forces and load
  jointInvolvement String  @db.Text  // Which joints are involved
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  bodyParts   ExerciseBodyPart[]
  workoutExercises WorkoutExercise[]
  
  @@map("exercises")
}

// Junction table for Exercise-BodyPart relationship with activation ranking
model ExerciseBodyPart {
  id            String   @id @default(uuid())
  exerciseId    String
  bodyPartId    String
  
  // Activation ranking (1 = most effective, higher = less effective)
  activationRank Int
  
  // Activation explanation
  activationDescription String @db.Text
  
  exercise   Exercise @relation(fields: [exerciseId], references: [id], onDelete: Cascade)
  bodyPart   BodyPart @relation(fields: [bodyPartId], references: [id], onDelete: Cascade)
  
  @@unique([exerciseId, bodyPartId])
  @@map("exercise_body_parts")
}

// ========== WORKOUT SYSTEM ==========

model WorkoutPlan {
  id          String   @id @default(uuid())
  userId      String
  name        String
  goal        String   // Same as User.fitnessGoal
  sport       String?  // Optional sport-specific training
  
  // Schedule
  daysPerWeek Int
  startDate   DateTime
  endDate     DateTime?
  
  isActive    Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  workouts    Workout[]
  
  @@map("workout_plans")
}

model Workout {
  id            String   @id @default(uuid())
  workoutPlanId String
  name          String
  dayOfWeek     Int      // 1-7 (Monday-Sunday)
  split         String   // "push", "pull", "legs", "upper", "lower", "full_body", etc.
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  workoutPlan   WorkoutPlan @relation(fields: [workoutPlanId], references: [id], onDelete: Cascade)
  exercises     WorkoutExercise[]
  
  @@map("workouts")
}

model WorkoutExercise {
  id          String   @id @default(uuid())
  workoutId   String
  exerciseId  String
  orderIndex  Int      // Order in the workout
  
  // Prescription
  sets        Int
  reps        String   // Can be range like "8-12" or specific like "10"
  rest        Int      // Rest in seconds
  notes       String?
  
  workout     Workout  @relation(fields: [workoutId], references: [id], onDelete: Cascade)
  exercise    Exercise @relation(fields: [exerciseId], references: [id], onDelete: Cascade)
  
  @@map("workout_exercises")
}

// ========== NUTRITION SYSTEM ==========

model Food {
  id          String   @id @default(uuid())
  name        String
  brand       String?
  
  // Serving info
  servingSize Float    // in grams
  servingUnit String   // "g", "ml", "piece", etc.
  
  // Macros (per serving)
  calories    Float
  protein     Float    // g
  carbs       Float    // g
  fat         Float    // g
  fiber       Float?   // g
  sugar       Float?   // g
  
  // Micros (per serving, in mg or mcg)
  vitaminA    Float?
  vitaminC    Float?
  vitaminD    Float?
  calcium     Float?
  iron        Float?
  potassium   Float?
  sodium      Float?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  nutritionLogs NutritionLog[]
  
  @@map("foods")
}

model NutritionLog {
  id          String   @id @default(uuid())
  userId      String
  foodId      String
  date        DateTime
  mealType    String   // "breakfast", "lunch", "dinner", "snack"
  
  // Quantity consumed
  servings    Float
  
  // Water intake (ml) - logged separately but in same table
  waterMl     Float?
  
  createdAt   DateTime @default(now())
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  food        Food     @relation(fields: [foodId], references: [id], onDelete: Cascade)
  
  @@map("nutrition_logs")
}

// ========== ACTIVITY TRACKING ==========

model ActivityLog {
  id          String   @id @default(uuid())
  userId      String
  date        DateTime
  
  // Activity data
  steps       Int
  distance    Float?   // km
  activeMinutes Int?
  
  // Calculated values
  caloriesBurned Float  // Based on steps and user data
  
  createdAt   DateTime @default(now())
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("activity_logs")
}

// ========== INJURY PREVENTION ==========

model MuscleUsageLog {
  id          String   @id @default(uuid())
  userId      String
  bodyPartId  String
  date        DateTime
  
  // Usage intensity (1-10 scale)
  intensity   Int
  
  // Recovery status
  isRecovered Boolean  @default(false)
  
  createdAt   DateTime @default(now())
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  bodyPart    BodyPart @relation(fields: [bodyPartId], references: [id], onDelete: Cascade)
  
  @@map("muscle_usage_logs")
}

// ========== REPORTING ==========

model Report {
  id          String   @id @default(uuid())
  userId      String
  type        String   // "daily", "weekly", "monthly"
  startDate   DateTime
  endDate     DateTime
  
  // Calculated metrics (stored as JSON for flexibility)
  nutritionData    Json  // Calories, macros, micros averages
  trainingData     Json  // Workout frequency, volume
  recoveryData     Json  // Overuse warnings, rest days
  activityData     Json  // Steps, active time
  
  generatedAt DateTime @default(now())
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("reports")
}
